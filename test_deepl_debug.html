<!DOCTYPE html>
<html>
<head>
    <title>DeepL API Debug Test</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>DeepL API Debug Test</h1>
    <div>
        <label for="apiKey">API Key:</label>
        <input type="password" id="apiKey" placeholder="Enter your DeepL API key"><br><br>
        <label for="apiPlan">API Plan:</label>
        <select id="apiPlan">
            <option value="free">Free</option>
            <option value="pro">Pro</option>
        </select><br><br>
        <label for="textInput">Text to translate:</label>
        <input type="text" id="textInput" value="Hello, world!" placeholder="Enter text"><br><br>
        <button onclick="testDeepL()">Test DeepL API</button>
    </div>
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; display: none;"></div>

    <script src="utils/deepl-api.js"></script>
    <script>
        async function testDeepL() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const apiPlan = document.getElementById('apiPlan').value;
            const text = document.getElementById('textInput').value.trim();
            const resultDiv = document.getElementById('result');

            if (!apiKey) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '❌ Please enter your API key';
                return;
            }

            if (!text) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '❌ Please enter text to translate';
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '⏳ Testing...';

            try {
                // Use the shared DeepL API utility
                console.log('Testing with:', { apiKey: '***', apiPlan, text });
                const result = await window.DeepLAPI.testDeepLConnection(apiKey, apiPlan, text);
                
                console.log('API result:', result);

                if (result.success) {
                    resultDiv.innerHTML = `✅ Success! Translation: "${result.translatedText}"`;
                } else {
                    let errorMessage;
                    switch (result.error) {
                        case 'API_KEY_MISSING':
                            errorMessage = '❌ API key is required';
                            break;
                        case 'UNEXPECTED_FORMAT':
                            errorMessage = '⚠️ API responded but with unexpected format';
                            break;
                        case 'NETWORK_ERROR':
                            errorMessage = `❌ Network Error: ${result.message}`;
                            break;
                        default:
                            if (result.error.startsWith('HTTP_')) {
                                errorMessage = `❌ API Error (${result.status}): ${result.message}`;
                            } else {
                                errorMessage = `❌ Error: ${result.message}`;
                            }
                            break;
                    }
                    resultDiv.innerHTML = errorMessage;
                }
            } catch (error) {
                console.error('Request failed:', error);
                resultDiv.innerHTML = `❌ Unexpected Error: ${error.message}`;
            }
        }
    </script>
</body>
</html> 